### å‰ç«¯ç½‘ç»œè¯·æ±‚å°è£…

æˆ‘ä»¬å¹³æ—¶å’ŒæœåŠ¡ç«¯æ‰“äº¤é“éƒ½éœ€è¦ä½¿ç”¨åˆ°ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯å¹³æ—¶å¼€å‘ä¸­æˆ‘ä»¬ä¸€èˆ¬éƒ½ç”¨åˆ«äººå°è£…å¥½çš„æ¯”å¦‚ ajaxã€axiosï¼Œæˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„åŸç”Ÿfetchæ–¹æ³•(ä»¥åå†è®²è¿™ä¸ªæ–¹æ³•çš„å°è£…)ã€‚æˆ‘ä»¬å­¦ä¹ çš„æ—¶å€™æ›´è¦çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•å°è£…ä¸€ä¸ªæœ€åŸºç¡€çš„ç½‘ç»œè¯·æ±‚å‡½æ•°ã€‚

#### äº†è§£Ajax

`XMLHttpRequest`ï¼ˆXHRï¼‰å¯¹è±¡ç”¨äºä¸æœåŠ¡å™¨äº¤äº’ã€‚é€šè¿‡ XMLHttpRequest å¯ä»¥åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹è¯·æ±‚ç‰¹å®š URLï¼Œè·å–æ•°æ®ã€‚è¿™å…è®¸ç½‘é¡µåœ¨ä¸å½±å“ç”¨æˆ·æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°é¡µé¢çš„å±€éƒ¨å†…å®¹ã€‚`XMLHttpRequest` åœ¨Ajaxç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨

#### readyStateçš„4ä¸ªçŠ¶æ€

- 0 - (æœªåˆå§‹åŒ–)è¿˜æ²¡æœ‰è°ƒç”¨send()æ–¹æ³•
- 1 - (è½½å…¥)å·²è°ƒç”¨send()æ–¹æ³•ï¼Œæ­£åœ¨å‘é€è¯·æ±‚
- 2 - (è½½å…¥å®Œæˆ)send()æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œå·²ç»æ¥æ”¶åˆ°å…¨éƒ¨å“åº”å†…å®¹
- 3 - (äº¤äº’)æ­£åœ¨è§£æå“åº”å†…å®¹
- **4 - (å®Œæˆ)å“åº”å†…å®¹è§£æå®Œæˆï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è°ƒç”¨äº† ï¼ˆä¸»è¦ï¼‰**

#### è¯·æ±‚çŠ¶æ€ç (Status)

**1XXï¼š** ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œï¼ˆä¸å¸¸ç”¨ï¼‰

**2XXï¼š** æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç† ã€‚**å¸¸è§ï¼š 200-OKï¼ˆæ­£å¸¸è¿”å›ï¼‰ã€201-Createdï¼ˆæˆåŠŸåˆ›å»ºï¼‰ã€204 - No Contentï¼ˆç½‘é¡µæœªæ›´æ–°æ—¶ï¼ŒæœåŠ¡å™¨æ­£å¸¸å¤„ç†ä½†æ²¡è¿”å›å†…å®¹ï¼‰**

**3XXï¼š** é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚ ã€‚**å¸¸è§ï¼š301 -  Moved Permanently ï¼ˆæ°¸ä¹…é‡å®šå‘ï¼Œ è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…çš„ç§»åŠ¨åˆ°æ–°URIï¼Œè¿”å›ä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„URIï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–°URI ï¼‰ã€302 -  Foundï¼ˆä¸´æ—¶é‡å®šå‘ï¼Œèµ„æºä¸´æ—¶è¢«ç§»åŠ¨ï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨åŸæœ‰URI ï¼‰ã€304 -  Not Modifiedï¼ˆ æœªä¿®æ”¹ã€‚è¯·æ±‚çš„èµ„æºæœªä¿®æ”¹ï¼Œä¸è¿”å›ä»»ä½•èµ„æºã€‚å®¢æˆ·ç«¯é€šå¸¸ä¼šç¼“å­˜è®¿é—®è¿‡çš„èµ„æºï¼‰**

**4XXï¼š** å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚**å¸¸è§ï¼š400 -  Bad Request ï¼ˆå®¢æˆ·ç«¯è¯·æ±‚è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ ï¼‰ã€401 - Unauthorizedï¼ˆæœªæˆæƒï¼Œä¸€èˆ¬æ˜¯éœ€è¦å…ˆç™»å½•æˆæƒï¼‰ã€403 -  Forbidden ï¼ˆ æœåŠ¡å™¨ç†è§£è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œ ï¼Œä¸€èˆ¬ç”¨äºæŸäº›é¡µé¢æƒé™çš„è®¾ç½®ï¼‰ã€404 - Not Foundï¼ˆèµ„æºè®¿é—®ä¸åˆ°ï¼‰**

**5XXï¼š** æœåŠ¡å™¨é”™è¯¯ï¼Œå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ ã€‚å¸¸è§ï¼š500ï¼ˆ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ ï¼‰ã€ 503ï¼ˆè¶…è½½æˆ–è€…åœ¨ç»´æŠ¤ï¼Œæš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ï¼‰

### å°è£…è¯·æ±‚å‡½æ•°

#### å›è°ƒå‡½æ•°ç‰ˆæœ¬

```js
function ajax(options) {
  // ES6è§£æ„å¹¶èµ‹äºˆé»˜è®¤å€¼
  const { url, method = 'GET', sync = true, responseType = 'json' } = options;

  const xhr = new XMLHttpRequest();

  xhr.open(method, url, sync);

  // è®¾ç½®å“åº”çš„ç±»å‹ï¼Œé»˜è®¤ä¸ºjson
  xhr.responseType = responseType;

  xhr.onreadystatechange = () => {
    if (xhr.readyState === 4 && xhr.status === 200) {
      // æˆåŠŸçš„å›è°ƒ
      options.success(xhr.response);
    }
  };

  xhr.onerror = (err) => {
    // é”™è¯¯çš„å›è°ƒ
    options.fail(err);
  };

  // æ­¤å¤„åªå¤„ç† get å’Œ post è¯·æ±‚ï¼Œè¿˜æœ‰ putã€deleteã€optionsçš„è¯·æ±‚å°±ä¸å¤„ç†äº†
  if (method === 'GET') {
    xhr.send();
  }

  // POST è¯·æ±‚éœ€è¦å‘é€è¯·æ±‚ä½“
  if (method === 'POST') {
    xhr.send(options.data);
  }
}

ajax({
  url: 'æ­¤å¤„å¡«å†™éœ€è¦å‘é€è¯·æ±‚çš„åœ°å€',
  success: (res) => {
    // æ‹¿åˆ°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®
    console.log(res);
  },
  fail: (err) => {
    console.log('é”™è¯¯å¤„ç†', err);
  },
});
```

#### Promise ç‰ˆæœ¬

Promise ç‰ˆæœ¬æˆ‘ä»¬åªæ˜¯åœ¨å‡½æ•°å†…è¿”å›äº†ä¸€ä¸ªPromiseï¼Œå¹¶å°†ç»“æœå’Œé”™è¯¯æŠ›å‡ºå»ï¼Œè¿™ç§æ–¹å¼æ›´åŠ æ¨èï¼Œå› ä¸ºå›è°ƒå‡½æ•°ç‰ˆæœ¬ä¼šå½¢æˆâ€œå›è°ƒåœ°ç‹±â€çš„é—®é¢˜ã€‚â€œå›è°ƒåœ°ç‹±â€æŒ‡çš„æ˜¯å‡½æ•°å±‚çº§ä¸æ–­çš„åµŒå¥—ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºğŸ‘‡

![image-20220312105445828](C:\Users\JqWang\AppData\Roaming\Typora\typora-user-images\image-20220312105445828.png)

```js
function ajax(options) {
  return new Promise((resolve, reject) => {
    // ES6è§£æ„å¹¶èµ‹äºˆé»˜è®¤å€¼
    const { url, method = 'GET', sync = true, responseType = 'json' } = options;

    const xhr = new XMLHttpRequest();

    xhr.open(method, url, sync);

    xhr.responseType = responseType;

    xhr.onreadystatechange = () => {
      if (xhr.readyState === 4 && xhr.status === 200) {
        resolve(xhr.response);
      }
    };

    xhr.onerror = (err) => {
      reject(err);
    };

    // æ­¤å¤„åªå¤„ç† get å’Œ post è¯·æ±‚ï¼Œè¿˜æœ‰ putã€deleteã€optionsçš„è¯·æ±‚å°±ä¸å¤„ç†äº†
    if (method === 'GET') {
      xhr.send();
    }

    if (method === 'POST') {
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      xhr.send(options.data);
    }
  });
}


ajax({ url: 'æ­¤å¤„å¡«å†™éœ€è¦å‘é€è¯·æ±‚çš„åœ°å€' })
  .then((res) => {
    // æ‹¿åˆ°æœåŠ¡ç«¯è¿”å›ç»“æœ
    console.log(res);
  })
  .catch((err) => {
    // é”™è¯¯å¤„ç†
    console.log(err);
  });

```

