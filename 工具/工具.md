## Centos

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGSs79GI8icW78Wxe2tGI9PKtElUkQ8hECZqEDMWYuCHFiaeXdDian4O2Ew/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

Centos æ˜¯ä¸€ä¸ªåŸºäº Linux çš„å¼€æºå…è´¹æ“ä½œç³»ç»Ÿï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›å¸¸ç”¨æ“ä½œ

```
# æœ¬åœ°æ‹·è´æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨scp output.txt root@47.93.242.155:/data/å¤åˆ¶ä»£ç 
```

- `output.txt`:æœ¬åœ°æ–‡ä»¶
- `root`:ç™»å½•è¿œç¨‹æœåŠ¡å™¨çš„è´¦å·
- `47.93.242.155`:è¿œç¨‹æœåŠ¡å™¨çš„ IP
- `/data/`:è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•

```
# æ‹·è´Dç›˜httpsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ° è¿œç¨‹çš„ /data ç›®å½•scp D:/https/* root@47.93.242.155:/dataå¤åˆ¶ä»£ç 
```

### æœ¬åœ°é“¾æ¥è¿œç¨‹ Centos æœåŠ¡å™¨

```
ssh \-p ç«¯å£ ç”¨æˆ·å@æœåŠ¡å™¨IP
```

ä¾‹å­:

```
ssh -p  22  root@47.93.242.155
#è¾“å…¥ç™»å½•å¯†ç 
#æˆåŠŸ
```

### yum åˆ‡æ¢ä¸ºé˜¿é‡Œæº

```
cd /etc/yum.repos.d/

curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-8.repo

#é‡æ–°ç”Ÿæˆç¼“å­˜--æŸ¥çœ‹æ‰§è¡Œç»“æœï¼Œå¦‚æœæœ‰aliyunå­—æ ·å°±ç®—æˆåŠŸ
yum makecache
```

### å…¶ä»–

```
#åˆ›å»º /data/testç›®å½•
mkdir /data/test 

#åˆ›å»º /data/newtestç›®å½•
mkdir /data/newtest

#åˆ›å»º /data/test/index.htmlæ–‡ä»¶
touch /data/test/index.html 

#ç¼–è¾‘æ–‡ä»¶vi /data/test/index.html 

#æŸ¥çœ‹æ–‡ä»¶å†…å®¹cat /data/www/index.html

#å°†testç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°newtestç›®å½•ä¸‹
cp â€“r /data/test/*  /data/newtest

#åˆ é™¤ /data/newtest/index.htmlæ–‡ä»¶
rm -rf /data/newtest/index.html

#å°†testç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ç›®å½•newtestç›®å½•ä¸‹
mv /data/test/*  /data/newtest

#æŸ¥çœ‹å½“å‰ç›®å½•çš„è·¯å¾„pwd
#æ£€æŸ¥ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨netstat -lnp|grep 88   
#88è¯·æ¢ä¸ºä½ éœ€è¦çš„ç«¯å£ï¼Œå¦‚ï¼š80å¤åˆ¶ä»£ç 
```

æ‰§è¡Œ`netstat \-lnp|grep ç«¯å£å·`ä¹‹åä¼šæ‰“å°å‡ºè¢«å ç”¨çš„è¿›ç¨‹åŠå…¶ç¼–å·

```
#æ€æ‰ç¼–å·ä¸º1777çš„è¿›ç¨‹ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µè¾“å…¥ï¼‰kill -9 1777å¤åˆ¶ä»£ç 
```

æŸ¥çœ‹å½“å‰ `Centos` æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯

```
cat /etc/redhat-releaseå¤åˆ¶ä»£ç 
```

## Nginx æœåŠ¡å™¨æ­å»º

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGCR7uvnaabf1fkFYbePnT6Rcg9Cdr5d0WMlMPoOummH27dsuQtQzA1A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† web æœåŠ¡å™¨ï¼Œä½¿ç”¨ nginx ç½‘ç«™æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ã€æ·˜å®ã€‚

### Centos ä¸‹å®‰è£… Nginx æœåŠ¡å™¨

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `yum` å®‰è£… Nginx æœåŠ¡å™¨ã€‚

```
yum install -y nginxå¤åˆ¶ä»£ç 
```

### å¯åŠ¨ Nginx æœåŠ¡å™¨

å®‰è£…åçš„ Nginx æ²¡æœ‰å¯åŠ¨ï¼Œå…ˆå¯åŠ¨ Nginx æœåŠ¡å™¨ã€‚

```
nginxå¤åˆ¶ä»£ç 
```

æ­¤æ—¶ï¼Œè®¿é—® `http://<æ‚¨çš„åŸŸåæˆ–IP>` å¯ä»¥çœ‹åˆ° Nginx çš„æµ‹è¯•é¡µé¢

> å¦‚æœæ— æ³•è®¿é—®ï¼Œè¯·é‡è¯•ç”¨ `nginx \-s reload` å‘½ä»¤é‡å¯ Nginx

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGWpTsjKRicjEprqoPcaLpadArH8RCibdGrpSVbDnPNJbbTE0YsIGvr2Bw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

### é…ç½®é™æ€æœåŠ¡å™¨è®¿é—®è·¯å¾„

å¤–ç½‘ç”¨æˆ·è®¿é—®æœåŠ¡å™¨çš„ Web æœåŠ¡ç”± `Nginx` æä¾›ï¼Œ`Nginx` éœ€è¦é…ç½®é™æ€èµ„æºçš„è·¯å¾„ä¿¡æ¯æ‰èƒ½é€šè¿‡ `url` æ­£ç¡®è®¿é—®åˆ°æœåŠ¡å™¨ä¸Šçš„é™æ€èµ„æºã€‚

æ‰“å¼€ `Nginx` çš„é»˜è®¤é…ç½®æ–‡ä»¶ `/etc/nginx/nginx.conf` ï¼Œä¿®æ”¹ Nginx é…ç½®

```
vi /etc/nginx/nginx.confå¤åˆ¶ä»£ç 
```

å°†é»˜è®¤çš„ `/usr/share/nginx/html`; ä¿®æ”¹ä¸º: `/data/www`;ï¼Œå¦‚ä¸‹ï¼š

ç¤ºä¾‹ä»£ç ï¼š`/etc/nginx/nginx.conf`

```
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80 default_server;
        listen       [::]:80 default_server;
        server_name  _;
        # ä¿®æ”¹ä¸ºä»¥ä¸‹è·¯å¾„
        root         /data/www;

        include /etc/nginx/default.d/*.conf;

        location / {
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }

}
```

é…ç½®æ–‡ä»¶å°† `/data/www/static` ä½œä¸ºæ‰€æœ‰é™æ€èµ„æºè¯·æ±‚çš„æ ¹è·¯å¾„ï¼Œå¦‚è®¿é—®: `http://<æ‚¨çš„åŸŸåæˆ–IP>/static/index.js`ï¼Œå°†ä¼šå» `/data/www/static/` ç›®å½•ä¸‹å»æŸ¥æ‰¾ `index.js/index.html`ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦é‡å¯ Nginx è®©æ–°çš„é…ç½®ç”Ÿæ•ˆï¼Œå¦‚ï¼š

```
nginx -s reload
```

### åˆ›å»ºç¬¬ä¸€ä¸ªé™æ€æ–‡ä»¶

ç°åœ¨è®©æˆ‘ä»¬æ–°å»ºä¸€ä¸ªé™æ€æ–‡ä»¶ï¼ŒæŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚

é¦–å…ˆè®©æˆ‘ä»¬åœ¨ `/data` ç›®å½• ä¸‹åˆ›å»º `www` ç›®å½•ï¼Œå¦‚ï¼š

```
mkdir -p /data/www
```

åœ¨ `/data/www` ç›®å½•ä¸‹åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé™æ€æ–‡ä»¶ `index.html`

```
touch /data/www/index.html

vi /data/www/index.html
```

ç¤ºä¾‹ä»£ç ï¼š`/data/www/index.html`

```html
<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>ç¬¬ä¸€ä¸ªé™æ€æ–‡ä»¶</title>
  </head>
  <body>
    <h1>Hello worldï¼</h1>
  </body>
</html>
```

ç°åœ¨è®¿é—® `http://<æ‚¨çš„åŸŸåæˆ–IP>/index.html` åº”è¯¥å¯ä»¥çœ‹åˆ°é¡µé¢è¾“å‡º `Hello world!`

åˆ°æ­¤ï¼Œä¸€ä¸ªåŸºäº Nginx çš„é™æ€æœåŠ¡å™¨å°±æ­å»ºå®Œæˆäº†ï¼Œç°åœ¨æ‰€æœ‰æ”¾åœ¨ `/data/www` ç›®å½•ä¸‹çš„çš„é™æ€èµ„æºéƒ½å¯ä»¥ç›´æ¥é€šè¿‡åŸŸå/IP è®¿é—®ã€‚

> å¦‚æœæ— æ˜¾ç¤ºï¼Œè¯·åˆ·æ–°æµè§ˆå™¨é¡µé¢

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGBXXheQe4CVKlkpibrfnhpHb6ZL3iaNictA91rmALqeSt33eZ8gIkVACLA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)indexHTML

### Nginx é…ç½® SSL æ³›åŸŸåè¯ä¹¦

è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„å…è´¹è¯ä¹¦ï¼ŒæœŸé™ä¸º 1 å¹´

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGYQqQxO5MD8GZ2u677dibySBy5b334jOJvSAT0YNm1MyibCxk0VV3cXzw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)aliyun-free-cert

è´­ä¹°æˆåŠŸåè¿›å…¥`sslè¯ä¹¦æ§åˆ¶å°` ä¸‹è½½è¯ä¹¦

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGq72MJaDXno2wCgibhPjLczNXD8oX0kM8f0v2FvuhJ5Nc3f7qcTKjx0Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)aliyun-download-cert

ä¸‹è½½ç”³è¯·å¥½çš„ ssl è¯ä¹¦æ–‡ä»¶å‹ç¼©åŒ…åˆ°æœ¬åœ°å¹¶è§£å‹æ”¾åˆ°è‡ªå·±å–œæ¬¢çš„ç›®å½•,å¦‚`D:/https/`ã€‚(è¿™é‡Œæ˜¯ç”¨çš„ pem ä¸ key æ–‡ä»¶ï¼Œæ–‡ä»¶åå¯ä»¥æ›´æ”¹)ã€‚

åœ¨è¿æ¥æœåŠ¡å™¨çš„çª—å£ä¸­åˆ›å»º `/data/cert` ç›®å½•ç”¨æ¥å­˜æ”¾è¯ä¹¦æ–‡ä»¶

```
mkdir /data/cert
```

ä½¿ç”¨ `scp` å‘½ä»¤ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨(è¿™é‡Œéœ€è¦æ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œä¸è¦ä½¿ç”¨è¿æ¥æœåŠ¡å™¨çš„çª—å£):

```
scp D:/https/* root@47.93.242.155:/data/cert
```

ä¸Šé¢çš„æ„æ€æ˜¯æ‹·è´`D:/https/`ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ `/data/cert`ç›®å½•ä¸­

- `D:/https/`:æœ¬åœ°æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
- `root`:é€šè¿‡ root ç”¨æˆ·ç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨
- `47.93.242.155`:è¿œç¨‹æœåŠ¡å™¨çš„ ip åœ°å€
- `/data/cert`:è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„è·¯å¾„

#### å¼€å¯ 443 ç›‘å¬

Nginx å¯åŠ¨åé»˜è®¤åªç›‘å¬ 80 ç«¯å£ã€‚

è¿™é‡Œæˆ‘ä»¬æŠŠ 443 ç«¯å£çš„ç›‘å¬ä¹Ÿä¸€å¹¶å¼€å¯ã€‚

ç¼–è¾‘å…¨å±€é…ç½®æ–‡ä»¶

```
vi /etc/nginx/nginx.conf
```

ç¤ºä¾‹ä»£ç ï¼š`/etc/nginx/nginx.conf`,**è¯´æ˜éƒ½åœ¨æ³¨é‡Šä¸­**

```
# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80;
        # ä¿®æ”¹åŸŸå
        server_name  nsuedu.cn;

        # å¦‚æœæ˜¯HTTPè¯·æ±‚åˆ™é‡å®šå‘åˆ°HTTPS
        rewrite ^(.*) https://$host$1 permanent;
    }

# Settings for a TLS enabled server.

    server {
         # æœåŠ¡å™¨ç«¯å£ä½¿ç”¨443ï¼Œå¼€å¯ssl
        listen       443 ssl http2 default_server;
        listen       [::]:443 ssl http2 default_server;

        # è¾“å…¥ä½ çš„åŸŸå
        server_name  nsuedu.cn;

        # ä¿®æ”¹é™æ€æ–‡ä»¶çš„è·¯å¾„
        root         /data/www;

        # sslè¯ä¹¦é…ç½®

        # ä¿®æ”¹è¯ä¹¦è·¯å¾„ä¸€
        ssl_certificate "/data/cert/4726867_www.nsuedu.cn.pem";
        # ä¿®æ”¹è¯ä¹¦è·¯å¾„äºŒ
        ssl_certificate_key "/data/cert/4726867_www.nsuedu.cn.key";

        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;  #ç¼“å­˜æœ‰æ•ˆæœŸ
        ssl_ciphers HIGH:!aNULL:!MD5;  #åŠ å¯†ç®—æ³•
        ssl_prefer_server_ciphers on;  #ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„é¦–é€‰ç®—æ³•

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / {
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }

}
```

é‡å¯ nginx

```
nginx -s reload
```

åœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://nsuedu.cn/`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGYTu3EN1F2Bm4MhbDjtkvMchUJLBNTp7duXMP9301VaAAH5C3Jnic1FQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)https-success

### é…ç½® Nginx åå‘ä»£ç†

å®¢æˆ·ç«¯å¯¹ä»£ç†æœåŠ¡å™¨æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦åšä»»ä½•é…ç½®ï¼Œç”¨æˆ·åªè¯·æ±‚åå‘ä»£ç†æœåŠ¡å™¨ï¼Œåå‘ä»£ç†æœåŠ¡å™¨é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨ï¼Œè·å–æ•°æ®åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–è€Œè¨€å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œåªæ˜¯æš´éœ²çš„æ˜¯ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œè€Œéšè—äº†çœŸå®æœåŠ¡å™¨çš„ IP åœ°å€ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGv1xwDFy6JptO1Runf7tgibibAHX4KbW1BfVvnowzfE6tRTqicdhdia6KjA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210416165016

> å‚è€ƒä»åŸç†åˆ°å®æˆ˜ï¼Œå½»åº•ææ‡‚ Nginxï¼

è®¿é—®è·¯å¾„:`/api/getUser`

1. ```
   å½“ nginx é…ç½®æ–‡ä»¶proxy_passçš„urlæœ«å°¾å¸¦/æ—¶ :
   ```

```
server {
        listen       80;
        server_name  www.123.com;

        location /api/ {
        proxy_pass http://127.0.0.1:18081/;
        }
    }
```

ä»£ç†åˆ°åç«¯çš„è·¯å¾„ä¸ºï¼š`http://127.0.0.1:18081/getUser`ï¼Œçœç•¥äº†åŒ¹é…åˆ°çš„`/api/`è·¯å¾„ï¼›

1. ```
   å½“ nginx é…ç½®æ–‡ä»¶proxy_passçš„urlæœ«å°¾ä¸å¸¦/æ—¶ï¼š
   ```

```
server {
        listen       80;
        server_name  www.123.com;

        location /api/ {
        proxy_pass http://127.0.0.1:18081;
        }
    }
```

ä»£ç†åˆ°åç«¯çš„è·¯å¾„ä¸ºï¼š`http://127.0.0.1:18081/api/getUser`ï¼Œè¿åŒåŒ¹é…åˆ°çš„`/api/`è·¯å¾„ï¼Œä¸€èµ·è¿›è¡Œåå‘ä»£ç†ï¼›

## Centos ä¸‹æ­å»º Node.js ç¯å¢ƒ

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG1VK71fM0lL0lMAQuVhPxEx4S0NPJ3vhYib6FNVoxHcM81miapAicg3Eqw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)node-logo

`Node.js` æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ `JavaScript`, æ˜¯åŸºäº `Chrome JavaScript V8` å¼•æ“å»ºç«‹çš„å¹³å°ã€‚

å®‰è£… Node.js çš„å‡ ç§æ–¹å¼

1. æ–¹æ³•ä¸€ï¼šä»`EPELåº“`å®‰è£…`Node.js`--`yum install nodejs`ï¼Œ**ä¸è¶³**:å®‰è£…çš„`node/npm`ç‰ˆæœ¬è¾ƒä½,éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ç‰ˆæœ¬
2. æ–¹æ³•äºŒ:ä½¿ç”¨å®˜æ–¹ç¼–è¯‘è¿‡çš„äºŒè¿›åˆ¶æ•°æ®åŒ…å®‰è£…,**ä¸è¶³**:å®‰è£…æ­¥éª¤ç¹æ‚
3. æ–¹æ³•ä¸‰: é€šè¿‡`NVM`å®‰è£…,æ–¹ä¾¿å¿«æ·**ä¸è¶³**:å®‰è£…æ—¶å›½å¤–çš„ç½‘ä¸å¥½ ğŸ¥¶
4. æ–¹æ³•å››:æºç ä¸‹è½½åç¼–è¯‘å®‰è£…,ç‰ˆæœ¬æ˜¯æœ€æ–°çš„

### yum install nodejs æ–¹å¼å®‰è£…

æŸ¥çœ‹å½“å‰ç³»ç»Ÿè‡ªå¸¦äº†å“ªäº›`nodejs`çš„ç‰ˆæœ¬

```
sudo dnf module list nodejs
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGmLolh1xWmUjAjGKNx3hxDsq8rkY8vUaOBr9ibedPia1evwdcrzYXGbyg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)centos-node-list

å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªç‰ˆæœ¬çš„ `Node`:`10`,`12`,`14`. åœ¨ç‰ˆæœ¬ 10 ä¸Šæœ‰ä¸ª`[d]`ç¬¦å·,å®ƒä»£è¡¨ç³»ç»Ÿå°†ä¼šé»˜è®¤å®‰è£…çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ æƒ³è¦åˆ‡æ¢é»˜è®¤å®‰è£…çš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤

```
sudo dnf module enable nodejs:14
```

å®‰è£… Node

```
sudo dnf install nodejs
```

æŸ¥çœ‹ node ç‰ˆæœ¬ï¼Œå¯ä»¥å‘ç°æ˜¯`Node14`çš„ç‰ˆæœ¬

```
node --v
```

### NVM æ–¹å¼å®‰è£…

æˆ‘ä»¬å¯èƒ½åŒæ—¶åœ¨è¿›è¡Œ 2 ä¸ªé¡¹ç›®ï¼Œè€Œ 2 ä¸ªä¸åŒçš„é¡¹ç›®æ‰€ä½¿ç”¨çš„ node ç‰ˆæœ¬åˆæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¹äºç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„`node`å°†ä¼šæ˜¯ä¸€ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œè€Œ`nvm`å°±æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿çš„**åœ¨åŒä¸€å°è®¾å¤‡ä¸Šè¿›è¡Œå¤šä¸ª`node`ç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢**

> æ³¨: ä½¿ç”¨æ­¤æ–¹å¼ï¼Œåœ¨åé¢çš„ Jenkins è„šæœ¬ä½¿ç”¨ npm/yarn ä¼šæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å’‹è§£å†³ï¼Œæ±‚å¤§ä½¬ç§‘æ™® ğŸ¤ª

ä¸‹é¢æ˜¯(2021/04)çš„æœ€æ–°ç¨³å®šç‰ˆ: å¯ä»¥åœ¨å»NVM å®˜ç½‘çœ‹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆæœ€æ–°çš„é“¾æ¥

```
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | cp
```

è¿˜éœ€è¦è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä»¥ç¡®è®¤ä¸Šä¸€æ¡å‘½ä»¤çš„æ›´æ”¹ç»“æœ

```
source ~/.bash_profile
```

æŸ¥çœ‹ Node ç‰ˆæœ¬åˆ—è¡¨

```
nvm list-remote
```

å®‰è£…ä¸€ä¸ªé•¿æœŸæ”¯æŒçš„ç‰ˆæœ¬

```
nvm install 14.16.1
```

ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ

```
nvm currentnode -vnpm -v
```

é€šè¿‡ ç¯å¢ƒå˜é‡`echo $PATH` æŸ¥çœ‹å®‰è£…çš„ä½ç½®

```
echo $PATH# æ‰“å°å‡ºçš„ç»“æœä¸­ï¼Œéœ€è¦å–å‡º `/root/.nvm/versions/node/v14.16.1/bin`
```

### ä½¿ç”¨å®˜æ–¹ç¼–è¯‘è¿‡çš„äºŒè¿›åˆ¶æ•°æ®åŒ…çš„æ–¹å¼å®‰è£…

> æ³¨: ä½¿ç”¨æ­¤æ–¹å¼ï¼Œåœ¨åé¢çš„ Jenkins è„šæœ¬ä½¿ç”¨ npm/yarn èƒ½å¤Ÿæ­£å¸¸è¿è¡Œ

ä¸‹é¢æ˜¯(2021/04)çš„æœ€æ–°ç¨³å®šç‰ˆ: å¯ä»¥åœ¨å»Node.js å®˜ç½‘çœ‹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆæœ€æ–°çš„é“¾æ¥

ä¸‹è½½ `14.16.0` åˆ°`/data` ç›®å½•

```
cd /datawget https://nodejs.org/dist/v14.16.0/node-v14.16.0-linux-x64.tar.xz
```

ä¸‹è½½å®Œæˆå, å°†å…¶è§£å‹

```
tar xvJf node-v14.16.0-linux-x64.tar.xz
```

å°†è§£å‹çš„ `Node.js` ç›®å½•ç§»åŠ¨åˆ° `/usr/local` ç›®å½•ä¸‹

```
mv node-v14.16.0-linux-x64 /usr/local/node-v14
```

é…ç½® `node` è½¯é“¾æ¥åˆ° `/bin` ç›®å½•

```
ln -s /usr/local/node-v14/bin/node /bin/node
```

### é…ç½®å’Œä½¿ç”¨ npm

`npm` æ˜¯ `Node.js` çš„åŒ…ç®¡ç†å’Œåˆ†å‘å·¥å…·ã€‚å®ƒå¯ä»¥è®© `Node.js` å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ è½»æ¾çš„å…±äº«ä»£ç å’Œå…±ç”¨ä»£ç ç‰‡æ®µ

ä¸‹è½½ `node` çš„å‹ç¼©åŒ…ä¸­å·²ç»åŒ…å«äº† `npm` , æˆ‘ä»¬åªéœ€è¦å°†å…¶è½¯é“¾æ¥åˆ° `bin` ç›®å½•ä¸‹å³å¯

```
ln -s /usr/local/node-v14/bin/npm /bin/npm
```

### é…ç½®ç¯å¢ƒå˜é‡

å°† `/usr/local/node-v14/bin` ç›®å½•æ·»åŠ åˆ° `$PATH` ç¯å¢ƒå˜é‡ä¸­å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨é€šè¿‡ `npm` å…¨å±€å®‰è£…çš„ç¬¬ä¸‰æ–¹å·¥å…·

```
echo 'export PATH=/usr/local/node-v14/bin:$PATH' >> /etc/profile
```

ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ

```
source /etc/profile
```

### ä½¿ç”¨ npm

é€šè¿‡ `npm` é…ç½®æ·˜å®æº

```
npm config set registry https://registry.npm.taobao.orgnpm get registry
```

å…¨å±€å®‰è£…`yarn`å¹¶é…ç½®æ·˜å®æº

```
npm install yarn -gyarn config set registry http://registry.npm.taobao.org/yarn config get registry
```

## åœ¨ Centos ä¸Šå®‰è£… Docker

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGhaEpSoeG8DAraaodeSPCohzP2chwQMiaN2WoL6kSVWHmKakRGznjQ4A/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)Logo-Docker

Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æˆ– Windows æœºå™¨ä¸Š

### Docker ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«

- Docker æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒåŸºäº Linux å†…æ ¸å®ç°

- Docker ä½“ç§¯æ›´å°:å®¹å™¨è¿è¡Œçš„æ˜¯ä¸å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼ˆå°½ç®¡å®ƒä»¬å¯ä»¥ï¼‰ï¼Œè™šæ‹Ÿæœºå¿…é¡»è¿è¡Œå®Œæ•´çš„æ“ä½œç³»ç»Ÿ

- Docker å¯åŠ¨é€Ÿåº¦æ›´å¿«:è™šæ‹Ÿæœºå¯åŠ¨éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨å¯ä»¥åœ¨æ•°æ¯«ç§’å†…å¯åŠ¨

- ç”¨é€”/ä½œç”¨

- - è™šæ‹Ÿæœºæ›´æ“…é•¿äº**å½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒ**,è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚
  - Docker é€šå¸¸ç”¨äº**éš”ç¦»ä¸åŒçš„åº”ç”¨**ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚

- æ¯”å–»

- - æ‹¥æœ‰å®Œå…¨ç‹¬ç«‹ï¼ˆéš”ç¦»ï¼‰çš„ç©ºé—´;
  - å±äºä¸åŒçš„å®¢æˆ·(è™šæ‹Ÿæœºæ‰€æœ‰è€…);
  - æ¯ä¸ªä»“åº“æœ‰å„è‡ªçš„åº“ç®¡äººå‘˜ï¼ˆå½“å‰è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼‰ï¼Œæ— æ³•ç®¡ç†å…¶å®ƒä»“åº“ã€‚ä¸å­˜åœ¨ä¿¡æ¯å…±äº«çš„æƒ…å†µ
  - Docker æ¯”ä½œé›†è£…ç®±ï¼šå„ç§è´§ç‰©çš„æ‰“åŒ…(å°†å„ç§åº”ç”¨ç¨‹åºå’Œä»–ä»¬æ‰€ä¾èµ–çš„è¿è¡Œç¯å¢ƒæ‰“åŒ…æˆæ ‡å‡†çš„å®¹å™¨,å®¹å™¨ä¹‹é—´éš”ç¦»)
  - æœåŠ¡å™¨è™šæ‹ŸåŒ–å°±å¥½æ¯”åœ¨ç å¤´ä¸Šï¼ˆç‰©ç†ä¸»æœºåŠè™šæ‹ŸåŒ–å±‚ï¼‰ï¼Œå»ºç«‹äº†**å¤šä¸ªç‹¬ç«‹çš„â€œå°ç å¤´â€â€”ä»“åº“ï¼ˆè™šæ‹Ÿæœºï¼‰**

### å®‰è£…ä¸é…ç½® Docker

åœ¨å¼€å§‹å®‰è£…ä¹‹å‰ï¼Œéœ€è¦å®‰è£… `device-mapper-persistent-data` å’Œ `lvm2` ä¸¤ä¸ªä¾èµ–ã€‚

- `device-mapper-persistent-data` æ˜¯ `Linux` ä¸‹çš„ä¸€ä¸ªå­˜å‚¨é©±åŠ¨ï¼Œ `Linux` ä¸Šçš„é«˜çº§å­˜å‚¨æŠ€æœ¯ã€‚
- `Lvm`çš„ä½œç”¨åˆ™æ˜¯åˆ›å»ºé€»è¾‘ç£ç›˜åˆ†åŒºã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `CentOS` çš„ `Yum` åŒ…ç®¡ç†å™¨å®‰è£…ä¸¤ä¸ªä¾èµ–ï¼š

```
yum install -y yum-utils device-mapper-persistent-data lvm2
```

ä¾èµ–å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬å°†é˜¿é‡Œäº‘çš„ `Docker` é•œåƒæºæ·»åŠ è¿›å»ã€‚å¯ä»¥åŠ é€Ÿ `Docker` çš„å®‰è£…ã€‚

```
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum install docker-ce -y
```

å®‰è£…å®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `systemctl` å¯åŠ¨æ¥å¯åŠ¨ `Docker` äº†ã€‚`systemctl` æ˜¯ `Linux`çš„è¿›ç¨‹ç®¡ç†æœåŠ¡å‘½ä»¤ï¼Œä»–å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯åŠ¨ `docker`

```
systemctl start dockersystemctl enable docker
```

æ¥ç€æ‰§è¡Œä¸€ä¸‹ `docker \-v`ï¼Œè¿™æ¡å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥çœ‹ `Docker` å®‰è£…çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹ `docker` å®‰è£…çŠ¶æ€ã€‚å¦‚æœæ­£å¸¸å±•ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œä»£è¡¨ `Docker` å·²ç»å®‰è£…æˆåŠŸã€‚

```
docker -v
```

è®¾ç½®å¼€æœºå¯åŠ¨

```
chkconfig docker on
```

### å…¶ä»–

æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨

```
docker ps
```

æ˜¾ç¤ºæœ¬åœ°é•œåƒåˆ—è¡¨

```
docker images
```

åˆ é™¤æœ¬åœ°ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ

```
docker rmi imageID
```

å®¹å™¨çš„å¯åŠ¨/å…³é—­/é‡å¯

```
docker stop containerIDdocker start containerIDdocker restart  containerID
```

åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨

```
docker rm containerID
```

### é…ç½®é˜¿é‡Œäº‘é•œåƒæº

åœ¨ `Docker` å®‰è£…å®Œæ¯•åï¼Œä¹‹åæˆ‘ä»¬å»æ‹‰å– `docker` é•œåƒæ—¶ï¼Œä¸€èˆ¬é»˜è®¤ä¼šå» `docker` å®˜æ–¹æºæ‹‰å–é•œåƒã€‚ä½†æ˜¯å›½å†…å‡ºæµ·ç½‘é€Ÿå®åœ¨æ˜¯å¤ªæ…¢ï¼Œæ‰€ä»¥é€‰æ‹©æˆ‘ä»¬æ›´æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒä»“åº“æºè¿›è¡Œé•œåƒä¸‹è½½åŠ é€Ÿã€‚

ç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæ‰“å¼€ é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ã€‚ç‚¹å‡»å·¦ä¾§èœå•æœ€ä¸‹é¢çš„`é•œåƒåŠ é€Ÿå™¨` ï¼Œé€‰æ‹© `CentOS` ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚æŒ‰ç…§å®˜ç½‘çš„æç¤ºæ‰§è¡Œå‘½ä»¤ï¼Œå³å¯æ›´æ¢ `docker` é•œåƒæºåœ°å€ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGs8wCVyrrMZFT15ZojsnPN1gibmcea57knlbBDodeVCSNJpzGnau3ZSg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)ea464ab9fe1941bba822a6131dd631c8_tplv-k3u1fbpfcp-zoom-1

### Docker å†…é…ç½® Nginx æ–¹å¼ä¸€(æ¨è)

å‚è€ƒ Nginx å®¹å™¨æ•™ç¨‹

```
docker container run -d -p 4030:80 --rm --name mynginx nginx
```

ä¸Šé¢å‘½ä»¤çš„å„ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹ã€‚

- `-d`ï¼šåœ¨åå°è¿è¡Œ
- `-p` ï¼šå®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° 127.0.0.1:4030
- `--rm`ï¼šå®¹å™¨åœæ­¢è¿è¡Œåï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶
- `--name`ï¼šå®¹å™¨çš„åå­—ä¸º mynginx
- æœ«å°¾çš„`nginx`ï¼šè¡¨ç¤ºæ ¹æ® nginx é•œåƒè¿è¡Œå®¹å™¨ã€‚

å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨è®¿é—® `IP:4030` äº†ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¾ç¤º Nginx çš„æ¬¢è¿é¡µã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG1kfAYUwdk9WnqicAxeVLKr5mpkFqllY5MJiccfN91H7okDREokTTib8wA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)docker-nginx-4030

ç„¶åï¼ŒæŠŠè¿™ä¸ªå®¹å™¨ç»ˆæ­¢ï¼Œç”±äº`--rm`å‚æ•°çš„ä½œç”¨ï¼Œå®¹å™¨æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ã€‚

```
docker container stop mynginx
```

### Docker å†…é…ç½® Nginx æ–¹å¼äºŒ

ä¸‹è½½ä¸€ä¸ªå®˜æ–¹çš„ `Nginx` é•œåƒåˆ°æœ¬åœ°

```
docker pull nginx
```

ä¸‹è½½å¥½çš„é•œåƒå°±ä¼šå‡ºç°åœ¨é•œåƒåˆ—è¡¨é‡Œ

```
docker images
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGykwwK1Tibxdly8aKSH8aeKicAJIRWB50m0gOJOCmWWtBG1kAhfmF8hLw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)docker-images

**è¿è¡Œå®¹å™¨**

```
docker run --name=nginx -d -p 4030:80 nginx
```

ä¸Šé¢å‘½ä»¤çš„è§£é‡Šå¦‚ä¸‹ï¼š

1. `--name`ï¼šè®¾ç½®å®¹å™¨çš„åç§°;
2. `-d`ï¼šè¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨;
3. `-p`ï¼šæŒ‡å®šç«¯å£æ˜ å°„ã€‚`4030`æ˜¯å®¿ä¸»æœºçš„ç«¯å£ï¼Œ`80`æ˜¯ Nginx å®¹å™¨å†…éƒ¨çš„ç«¯å£;
4. æœ«å°¾çš„`nginx`ï¼šè¡¨ç¤ºæ ¹æ® nginx é•œåƒè¿è¡Œå®¹å™¨ã€‚

å¦‚å›¾æ‰€ç¤º

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGG3aOcYChMp9YNxVVDrGC90MK51joL85p1pMRhvTViccBRFEzzOSjQNw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)docker-nginx-started

ç„¶ååœ¨æµè§ˆå™¨é‡Œé¢è®¿é—® `http://47.93.242.155:4030/`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG1kfAYUwdk9WnqicAxeVLKr5mpkFqllY5MJiccfN91H7okDREokTTib8wA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)docker-nginx-4030

#### ç»™ Docker å†…çš„ Nginx é…ç½®åå‘ä»£ç†

è¦ä¿®æ”¹ Nginx çš„é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆéœ€è¦è¿›å…¥ Nginx å®¹å™¨é‡Œé¢ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤**è¿›å…¥å®¹å™¨é‡Œé¢**

```
docker exec -it nginx /bin/bash
```

ä¸Šé¢å‘½ä»¤çš„è§£é‡Šè¯´æ˜ï¼š

- `-it`ï¼šè¡¨ç¤ºåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚
- `nginx`ï¼šè¡¨ç¤ºå®¹å™¨çš„åç§°ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨å®¹å™¨ IDã€‚
- `/bin/bash`ï¼šè¡¨ç¤ºå¯¹å®¹å™¨æ‰§è¡Œ bash æ“ä½œã€‚

æˆ‘ä»¬ä½¿ç”¨`ls`æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ç»“æ„ï¼Œå‘ç°é‡Œé¢å…¶å®å°±æ˜¯ä¸€ä¸ª `Linux` æ“ä½œç³»ç»Ÿã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGJ8AJO2r1wc8mZovsBqLHhA7WwrLYcog8NFmyGCfCrgl8PGPL3icrhdQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210415235729

å†æŸ¥çœ‹ä¸€ä¸‹è¯¦ç»†çš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯

```
cat /etc/issueå¤åˆ¶ä»£ç 
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGT1klia231xo2EiaibvkKdlibqqWFibIKP7oME9oOmmSapLIk8Licso8F8FZQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)cat-etc-issue

å¯ä»¥å‘ç°æ˜¯ä¸€ä¸ª`Debian`ç³»ç»Ÿ

### `Debian`ç³»ç»Ÿ

é¡ºä¾¿ä»‹ç»ä¸€äº› `Debian`ç³»ç»Ÿçš„åŸºæœ¬æ“ä½œ

```
# é¦–å…ˆéœ€è¦æ›´æ–°ä¸€ä¸‹apt-get update# å®‰è£…vimapt-get install vim
```

#### ä¿®æ”¹ä¸ºæ¸…åæºé•œåƒ

å‚è€ƒDebian é•œåƒä½¿ç”¨å¸®åŠ©

å¦‚æœé‡åˆ°æ— æ³•æ‹‰å– https æºçš„æƒ…å†µï¼Œè¯·å…ˆä½¿ç”¨ http æºå¹¶å®‰è£…ï¼š

```
sudo apt install apt-transport-https ca-certificates
```

æŸ¥çœ‹ Debian ç‰ˆæœ¬,ä»¥ä¾¿é€‰æ‹©å¯¹åº”çš„é•œåƒæº

Debian ç‰ˆæœ¬ç®€ä»‹:

- ä¸‹ä¸€ä»£ Debian æ­£å¼å‘è¡Œç‰ˆçš„ä»£å·ä¸º `buster`
- Debian 9ï¼ˆ`stretch`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian 8ï¼ˆ`jessie`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian 7ï¼ˆ`wheezy`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian 6.0ï¼ˆ`squeeze`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 5.0ï¼ˆ`lenny`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 4.0ï¼ˆ`etch`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 3.1ï¼ˆ`sarge`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 3.0ï¼ˆ`woody`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 2.2ï¼ˆ`potato`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 2.1ï¼ˆ`slink`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ
- Debian GNU/Linux 2.0ï¼ˆ`hamm`ï¼‰ â€” è¢«æ·˜æ±°çš„ç¨³å®šç‰ˆ

æŸ¥çœ‹ç‰ˆæœ¬å½“å‰æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯ã€‚è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥æ¸…æ¥šçš„çŸ¥é“åˆ°åº•æ˜¯ RedHat çš„ã€è¿˜æ˜¯åˆ«çš„å‘è¡Œç‰ˆï¼Œè¿˜æœ‰å…·ä½“çš„ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ 3.4 è¿˜æ˜¯ 5.4 ç­‰ç­‰

```
cat /etc/os-release
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGTIcj8b1ZTwg8pAHDOwVnF2ATPPiavVJTRCIrATicusuVhicibGKfDYiaqDw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)cat-etc.-os

ä¿®æ”¹é•œåƒæ–‡ä»¶

```
vi /etc/apt/sources.list
```

ä¿®æ”¹å†…å®¹å¦‚ä¸‹

```
# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-freedeb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-freedeb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-freedeb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
```

------

Nginx é»˜è®¤ä¼šå®‰è£…åœ¨ `etc` ç›®å½•ä¸‹é¢, æŸ¥çœ‹ Nginx çš„é…ç½®æ–‡ä»¶çš„å†…å®¹

```

```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGtLGGqhvEOSSiaI7GCvNKf0NqbnMeH9SiaPnwN4tSS95EGUHCGcNA0ic7g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210415235137

æˆ‘ä»¬çœ‹æœ€åçº¢æ¡†é‡Œé¢çš„å†…å®¹ï¼Œè¡¨ç¤ºä½¿ç”¨çš„æ˜¯`/etc/nginx/conf.d/default.conf`æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚

é‚£ä¹ˆæˆ‘ä»¬ç¼–è¾‘`/etc/nginx/conf.d/default.conf`æ–‡ä»¶å³å¯ã€‚

```
vi /etc/nginx/conf.d/default.conf
```

**é…ç½®æ–¹å¼ä¸å‰æ–‡çš„ nginx é…ç½®ä¸€æ ·**ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦æŠŠå¿…è¦çš„æ–‡ä»¶(é™æ€æ–‡ä»¶,SSL è¯ä¹¦)ä¼ é€’ç»™ Docker å®¹å™¨

åˆ›å»ºå­˜æ”¾èµ„æºçš„ç›®å½•

```
mkdir /data/certmkdir /data/www
```

**é€€å‡º `docker` å®¹å™¨**ï¼Œåˆ°æœåŠ¡å™¨ç•Œé¢

```
exit
```

**æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ä¿¡æ¯**ï¼Œèƒ½è·å–å®¹å™¨çš„ `id`,å¦‚ä¸‹å›¾

```
docker ps -a
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGdwNI7nsgiaF0ggKZUGhwCUZZaNqP0k5uqbwibVBODl86kF0QCqISJfqg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)docker-ps-a

åœ¨æœåŠ¡å™¨ç»ˆç«¯æŠŠèµ„æºæ–‡ä»¶ä¼ é€’ç»™ `docker`ä¸‹çš„`nginx`å®¹å™¨

```
docker cp /data/cert 6ba3901beac9:/data/cert
```

**ä¿å­˜å®¹å™¨**

ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¿å­˜é•œåƒï¼š

```
docker commit -m="å¤‡æ³¨" ä½ çš„CONTAINER_ID ä½ çš„IMAGE
```

> è¯·è‡ªè¡Œå°† -m åé¢çš„ä¿¡æ¯æ”¹æˆè‡ªå·±çš„å®¹å™¨çš„ä¿¡æ¯

å¤§åŠŸå‘Šæˆï¼

æ­å–œä½ ç»“æŸäº† Docker çš„æ•™ç¨‹å¹¶å­¦ä¼šäº† Docker çš„ä¸€äº›åŸºæœ¬æ“ä½œ

## Centos ä¸‹å®‰è£… Jenkins

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGcTk3yfzFRiatWlhksNtpf1yIaCE7WJVQGVQn6ZMdvV59bicf2QFBmcXw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)jenkins-logo

`Jenkins` æ˜¯ä¸€ä¸ªåŸºäº `Java` è¯­è¨€å¼€å‘çš„æŒç»­æ„å»ºå·¥å…·å¹³å°ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•ä½ çš„è½¯ä»¶å’Œé¡¹ç›®ã€‚å®ƒå¯ä»¥æ‰§è¡Œä½ é¢„å…ˆè®¾å®šå¥½çš„è®¾ç½®å’Œæ„å»ºè„šæœ¬ï¼Œä¹Ÿå¯ä»¥å’Œ `Git` ä»£ç åº“åšé›†æˆï¼Œå®ç°è‡ªåŠ¨è§¦å‘å’Œå®šæ—¶è§¦å‘æ„å»ºã€‚

è¿™éƒ¨åˆ†å†…å®¹å¤§å¤šå†…å®¹æ˜¯å¯¹ä» 0 åˆ° 1 å®ç°ä¸€å¥— CI/CD æµç¨‹ æ˜é‡‘å°å†Œçš„æ¬è¿ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥å­¦ä¹ è¿™æœ¬å°å†Œ

### å®‰è£… OpenJDK

å› ä¸º `Jenkins` æ˜¯ `Java` ç¼–å†™çš„æŒç»­æ„å»ºå¹³å°ï¼Œæ‰€ä»¥å®‰è£… `Java` å¿…ä¸å¯å°‘ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©å®‰è£…å¼€æºçš„ `openjdk` ã€‚åœ¨è¿™æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `yum` åŒ…ç®¡ç†å™¨å®‰è£… `openjdk` å³å¯ã€‚

```
yum install -y java
```

### ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿå®‰è£… Jenkins

å®˜æ–¹æ•™ç¨‹ å®‰è£…é€Ÿåº¦å¤ªæ…¢ã€‚å› æ­¤æˆ‘ä»¬é€‰æ‹©å›½å†…é•œåƒå®‰è£…

ä¸‹é¢æ˜¯(2021/04)çš„ jenkins LTS ç‰ˆæœ¬: å¯ä»¥åœ¨å» æ¸…åå¤§å­¦é•œåƒç«™ çœ‹ä¸€ä¸‹ï¼Œæ›¿æ¢æˆæœ€æ–°çš„é“¾æ¥

ä¸‹è½½ `Jenkins` åˆ°`/data` ç›®å½•

```
cd  /datawget https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.277.2-1.1.noarch.rpmsudo yum install jenkins-2.277.2-1.1.noarch.rpm
```

### å¯åŠ¨ Jenkins

`Jenkins` å®‰è£…åï¼Œä¼šå°†å¯åŠ¨å‘½ä»¤æ³¨å†Œåˆ°ç³»ç»Ÿ `Service` å‘½ä»¤ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç³»ç»Ÿ `service` å‘½ä»¤å¯åŠ¨ `Jenkins` å³å¯ã€‚

åœ¨è¿™é‡Œï¼Œæœ‰ä¸‰ä¸ªå‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œåˆ†åˆ«å¯¹åº” å¯åŠ¨ / é‡å¯ / åœæ­¢ ä¸‰ä¸ªå‘½ä»¤ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨ `service jenkins start` å¯åŠ¨ `Jenkins` å³å¯

```
service jenkins start# service jenkins restart restart é‡å¯ Jenkins# service jenkins restart stop åœæ­¢ Jenkins
```

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® `IP:8080` ã€‚å¦‚æœèƒ½å¤Ÿçœ‹åˆ°ä»¥ä¸‹ç•Œé¢ï¼Œä»£è¡¨æ­£åœ¨å¯åŠ¨ã€‚`Jenkins` ç¬¬ä¸€æ¬¡çš„å¯åŠ¨æ—¶é—´ä¸€èˆ¬æ¯”è¾ƒé•¿ï¼ˆè§†æœåŠ¡å™¨æ€§èƒ½è€Œçœ‹ï¼‰

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGM5icXS25XQuYiadFB1QmCFNQ8S6SMiaXhA2SJAP6sYUr8tlib5KGBhmjmw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414231359

### åˆå§‹åŒ– Jenkins é…ç½®

#### è§£é” Jenkins

åœ¨ `Jenkins` å¯åŠ¨å®Œæˆåï¼Œä¼šè‡ªåŠ¨è·³è½¬è‡³è¿™ä¸ªç•Œé¢ï¼ˆä¸‹æ–¹äºŒå›¾ï¼‰ã€‚è¿™æ˜¯ `Jenkins` çš„è§£é”ç•Œé¢ï¼Œä½ éœ€è¦è¾“å…¥å­˜æ”¾åœ¨æœåŠ¡å™¨çš„åˆå§‹è§£é”å¯†ç æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚

`Jenkins` å¯åŠ¨åï¼Œä¼šç”Ÿæˆä¸€ä¸ªåˆå§‹å¯†ç ã€‚è¯¥å¯†ç åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶å†…å­˜æ”¾ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥æœåŠ¡å™¨æŸ¥çœ‹å¯†ç å†…å®¹ï¼Œå°†å¯†ç å¡«å†™åœ¨ `Jenkins` çš„ç®¡ç†å‘˜å¯†ç è¾“å…¥æ¡†å†…ï¼š

```
cat /var/lib/jenkins/secrets/initialAdminPassword
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGehh12YGwlncUkicib3h848acQAhDJxrkFlb2qlpN00EYx9Fc1ia9ia6aCA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414231503

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGN2FDdnbRNHC47zHcLsLRDKFepgP6VmJcO6icnSGrhWM2I4GnJZeXlew/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414231520

ç‚¹å‡» ç»§ç»­ æŒ‰é’®ï¼Œè§£é” Jenkinsã€‚

### ä¸‹è½½æ’ä»¶

è§£é”åå°±æ¥åˆ°äº†æ’ä»¶ä¸‹è½½é¡µé¢ï¼Œè¿™ä¸€æ­¥è¦ä¸‹è½½ä¸€äº› `Jenkins` çš„åŠŸèƒ½æ’ä»¶ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG4tKWQoJRfrvyS34j6RNsIePGa7jqK791mjYGch3un80q3cWicP0piauQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414231547

å› ä¸º `Jenkins` æ’ä»¶æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œæ‰€ä»¥é€Ÿåº¦ä¸å¤ªç†æƒ³ã€‚æˆ‘ä»¬éœ€è¦æ›´æ¢ä¸ºæ¸…åå¤§å­¦çš„ `Jenkins`æ’ä»¶æºåï¼Œå†å®‰è£…æ’ä»¶ï¼Œæ‰€ä»¥å…ˆä¸è¦ç‚¹å®‰è£…æ’ä»¶ã€‚

æ›´æ¢æ–¹æ³•å¾ˆç®€å•ã€‚è¿›å…¥æœåŠ¡å™¨ï¼Œå°† `/var/lib/jenkins/updates/default.json` å†…çš„æ’ä»¶æºåœ°å€æ›¿æ¢æˆæ¸…åå¤§å­¦çš„æºåœ°å€ï¼Œå°† `google` æ›¿æ¢ä¸º `baidu` å³å¯ã€‚

```
sed -i 's/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' /var/lib/jenkins/updates/default.json && sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' /var/lib/jenkins/updates/default.json
```

æ¥ç€ç‚¹å‡» å®‰è£…æ¨èçš„æ’ä»¶ å³å¯ã€‚ç¨ç­‰ä¸€ä¼šæ’ä»¶å®‰è£…å®Œæ¯•

### å®Œæˆå®‰è£…

æ’ä»¶å®‰è£…å®Œæ¯•åï¼Œæ¥ç€æ˜¯æ³¨å†Œç®¡ç†å‘˜è´¦å·ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG8dL8w6D6rAdz8vjVEMxdxTHW5b9HC0ZnXj8hdVvk4OzMicmMUktOribg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)jenkis-welcome

æŒ‰ç…§æç¤ºä¸€è·¯é…ç½®åï¼Œç›´åˆ°çœ‹åˆ°ä»¥ä¸‹ç•Œé¢ä»£è¡¨å®‰è£…æˆåŠŸ

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGvGaMfA1fwW6JDuCuakicia49RQq4EaWSKkvszKVXxW7bBeQjWUuJCH4Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414231814

### æµ‹è¯•å®‰è£…

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ `Jenkins` ç®—æ˜¯å¯åŠ¨æˆåŠŸäº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ `Jenkins` åšä¸€ç‚¹ç‚¹ç®€å•çš„é…ç½®ï¼Œæ‰å¯ä»¥è®©å®ƒå¯ä»¥æ„å»º `docker` é•œåƒã€‚

æˆ‘ä»¬ç‚¹å‡» `Jenkins é¦–é¡µ` -> `å·¦ä¾§å¯¼èˆª` -> `æ–°å»ºä»»åŠ¡` -> `Freestyle project(æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®)`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGgb9EicicyV26tlbj9cbMPoLG1FQ1WlFkxBvAzPUSYXYyZgsxe0H6zlXw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414232035

æ–°å»ºå®Œæ¯•åï¼Œæ‰¾åˆ° æ„å»º ä¸€é¡¹ï¼Œé€‰æ‹© å¢åŠ æ„å»ºæ­¥éª¤ï¼Œé€‰æ‹© æ‰§è¡Œ `shell` ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤

```
docker -vdocker pull node:latest
```

è¯¥å‘½ä»¤ä¼šå»æ‹‰å–ä¸€ä¸ª `nodejs` ç¨³å®šç‰ˆçš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯• `Docker` çš„å¯ç”¨æ€§

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGCvWrkh2bJqlIXlga6PRXiaukcI1lF02b1YHtwe8lOoIGq1bGEJ23icNw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414232101

ä¿å­˜åï¼Œæˆ‘ä»¬ç‚¹å‡»å·¦ä¾§èœå•çš„ç«‹å³æ„å»ºï¼Œ `Jenkins` å°±ä¼šå¼€å§‹æ„å»ºã€‚é€‰æ‹©å·¦ä¾§å†å²è®°å½•ç¬¬ä¸€é¡¹ï¼ˆæœ€æ–°çš„ä¸€é¡¹ï¼‰ï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºï¼ŒæŸ¥çœ‹æ„å»ºæ—¥å¿—ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGdfpOIAD75EYlRDXnKEXFuj0Mib4aiasxJwlFHzJ4ayoicIbSAch1p0cdg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414232116

æ‰§è¡Œåï¼Œæˆ‘ä»¬å‘ç°æç¤ºæ— è®¿é—®æƒé™ã€‚è¿™åˆæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿè¿™é‡Œå°±ä¸å¾—ä¸æåˆ° Linux ä¸‹çš„ `Unix Socket` æƒé™é—®é¢˜äº†

åœ¨ `Linux` ä¸­ï¼Œ `Unix socket` å±äº `root` ç”¨æˆ·ï¼Œå› æ­¤éœ€è¦ `root` æƒé™æ‰èƒ½è®¿é—®

ä½†æ˜¯åœ¨ `docker` ä¸­ï¼Œ `docker` æä¾›äº†ä¸€ä¸ª ç”¨æˆ·ç»„ çš„æ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰§è¡Œ `Shell` çš„ç”¨æˆ·æ·»åŠ åˆ°åç§°ä¸º `docker` çš„ç”¨æˆ·ç»„ï¼Œåˆ™å¯ä»¥æ­£å¸¸æ‰§è¡Œ `docker` å‘½ä»¤ã€‚

è€Œåœ¨ `Jenkins` ä¸­æ‰§è¡Œçš„ç»ˆç«¯ç”¨æˆ·åš `jenkins` ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°† `jenkins` åŠ å…¥åˆ° `docker`ç”¨æˆ·ç»„å³å¯ï¼š

```
sudo groupadd docker          #æ–°å¢dockerç”¨æˆ·ç»„
sudo gpasswd -a jenkins docker  #å°†å½“å‰ç”¨æˆ·æ·»åŠ è‡³dockerç”¨æˆ·ç»„
newgrp docker                 #æ›´æ–°dockerç”¨æˆ·ç»„
```

åŠ å…¥åï¼Œé‡å¯ `Jenkins` ï¼š

```
sudo service jenkins restart
```

é‡å¯ `Jenkins` åï¼Œå†æ¬¡æ‰§è¡Œè„šæœ¬ã€‚æ­¤æ—¶æ‰§è¡ŒæˆåŠŸï¼š

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGNhSQKue7trge1X9g6ZlicaXRnrTTqb7EJPl8tFQRsib2nibr6nabYqonw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414232608

### å›è¿‡å¤´æ¥æŸ¥çœ‹ docker é•œåƒ

```
docker images
```

ä¼šå‘ç°å¤šäº†ä¸€ä¸ª`docker`çš„`node`é•œåƒ,è¿™å°±æ˜¯æˆ‘ä»¬é€šè¿‡`Jenkins` è‡ªåŠ¨å®‰è£…çš„

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGIHzvwPXXZcUe4EKKEZW4gIJRKgQLW2sa5QyE5xBic8J2NfReIs86NWQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)node-in-docker

è¿›å…¥æ­¤`docker`é•œåƒ

```
docker run -it node /bin/bash
```

åšä¸€äº›é…ç½®(å¦‚ä½•åšå‚è€ƒå‰æ–‡çš„è¯´æ˜)

- `npm` é…ç½®æ·˜å®æº
- å…¨å±€å®‰è£… `yarn` å¹¶é…ç½®é…ç½®æ·˜å®æº

```
npm config set registry https://registry.npm.taobao.orgnpm get registry# å¯èƒ½æç¤ºå·²å®‰è£…ï¼Œå°±ä¸ç”¨å†å®‰è£…äº†npm install yarn -gyarn config set registry http://registry.npm.taobao.org/yarn config get registryexit
```

### ä½¿ç”¨ SSH åè®®é›†æˆ Git ä»“åº“æº

è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Jenkins` é›†æˆå¤–éƒ¨ `Git` ä»“åº“ï¼Œå®ç°å¯¹çœŸå®ä»£ç çš„æ‹‰å–å’Œæ„å»ºã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰ç”¨ `Gitee`(Github å¤ªæ…¢äº† ğŸ¤§) ä½œä¸ºæˆ‘ä»¬çš„ä»£ç æºã€‚è¿™é‡Œå‡†å¤‡ä¸€ä¸ª UmiJS é¡¹ç›®æ¥æ¼”ç¤ºæ„å»ºã€‚

### ç”Ÿæˆå…¬é’¥ç§é’¥

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥é…ç½®å…¬é’¥å’Œç§é’¥ã€‚è¿™æ˜¯ `Jenkins` è®¿é—® `Git` ç§æœ‰åº“çš„å¸¸ç”¨è®¤è¯æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `ssh-keygen` å‘½ä»¤å³å¯ç”Ÿæˆå…¬é’¥ç§é’¥ã€‚åœ¨æœ¬åœ°æœºå™¨æ‰§è¡Œç”Ÿæˆå³å¯ã€‚è¿™é‡Œçš„é‚®ç®±å¯ä»¥æ¢æˆä½ è‡ªå·±çš„é‚®ç®±ï¼š

```
ssh-keygen -t rsa -C "642178633@qq.com"
```

æ‰§è¡Œåï¼Œä¼šé‡åˆ°ç¬¬ä¸€æ­¥éª¤ï¼š`Enter file in which to save the key` ã€‚

è¿™ä¸€æ­¥æ˜¯è¯¢é—®ä½ è¦å°†å…¬é’¥ç§é’¥æ–‡ä»¶æ”¾åœ¨å“ªé‡Œã€‚é»˜è®¤æ˜¯æ”¾åœ¨ `~/.ssh/id_rsa` ä¸‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è¾“å…¥ä½ è‡ªå·±çš„è·¯å¾„ã€‚ä¸€è·¯å›è½¦å³å¯ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGJMicfvicG39koqsiajxxTKSMhe8UHEtspgN5aTQ6icLjUofD3btHCpN1dQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414234455

ç»“æŸåï¼Œä½ ä¼šå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ã€‚åˆ†åˆ«æ˜¯ `id_rsa` å’Œ `id_rsa.pub`ã€‚

å…¶ä¸­ï¼Œ`id_rsa` æ˜¯ç§é’¥æ–‡ä»¶ï¼Œ`id_rsa.pub` æ˜¯å¯¹åº”çš„å…¬é’¥æ–‡ä»¶ã€‚

æˆ‘ä»¬éœ€è¦åœ¨ Git ç«¯é…ç½®å…¬é’¥ï¼Œåœ¨ Jenkins ç«¯ä½¿ç”¨ç§é’¥ä¸ Git è¿›è¡Œèº«ä»½æ ¡éªŒã€‚

#### åœ¨ Gitee é…ç½®å…¬é’¥

åœ¨ `Gitee` ä¸­ï¼Œå¦‚æœä½ è¦é…ç½®å…¬é’¥æœ‰ 2 ç§æ–¹å¼ï¼šä»“åº“å…¬é’¥ å’Œ ä¸ªäººå…¬é’¥ã€‚å…¶ä¸­ï¼Œå¦‚æœé…ç½®äº†ä»“åº“å…¬é’¥ï¼Œåˆ™è¯¥å…¬é’¥åªèƒ½å¯¹é…ç½®çš„ä»“åº“è¿›è¡Œè®¿é—®ã€‚å¦‚æœé…ç½®äº†ä¸ªäººå…¬é’¥ï¼Œåˆ™è´¦å·ä¸‹æ‰€æœ‰ç§æœ‰ä»“åº“éƒ½å¯ä»¥è®¿é—®ã€‚

è¿™é‡Œæˆ‘ä»¬å°±ä»¥é…ç½®ä¸ªäººå…¬é’¥ä¸ºä¾‹å­ã€‚é¦–å…ˆæ‰“å¼€å³ä¸Šè§’çš„è®¾ç½® ï¼Œç‚¹å‡»ä¸‹é¢çš„ `è®¾ç½®` => `SSH å…¬é’¥`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGJGkQ07eDFb4meiaSz1MicfMGRehTib36mp6odvHLebCIWrMtRBiaJicgqPg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)gitee-ssh-first

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGzLJMLbic7eWvuiaTGdawjs1Q60njGcwUEUlWHlAlic2y3DryUf6Yib1qSA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)gitee-ssh-second

åœ¨ä¸‹æ–¹æœ‰ä¸ªæ·»åŠ å…¬é’¥ï¼Œå¡«å…¥ä¿¡æ¯å³å¯ã€‚

å…¶ä¸­çš„æ ‡é¢˜ä¸ºå…¬é’¥æ ‡é¢˜ï¼Œè¿™é‡Œå¯ä»¥è‡ªå®šä¹‰æ ‡é¢˜ï¼›å…¬é’¥åˆ™ä¸ºåˆšæ‰ç”Ÿæˆçš„ `id_rsa.pub` æ–‡ä»¶ã€‚ä½¿ç”¨`cat` å‘½ä»¤æŸ¥çœ‹ä¸‹æ–‡ä»¶å†…å®¹ï¼Œå°†å†…å®¹å¡«å…¥è¾“å…¥æ¡†å¹¶ä¿å­˜ã€‚æ¥ç€å» `Jenkins` ç«¯é…ç½®ç§é’¥

```
cat ~/.ssh/id_rsa.pub
```

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGialseNPdibSMbsQyiaxKRgxjd7DbjLe5Ip4QP5pkia6xvqVHeC74ODg8GQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414235532

#### åœ¨ Jenkins é…ç½®ç§é’¥

å›åˆ° `Jenkins`ã€‚åœ¨ `Jenkins` ä¸­ï¼Œç§é’¥/å¯†ç  ç­‰è®¤è¯ä¿¡æ¯éƒ½æ˜¯ä»¥ å‡­è¯ çš„æ–¹å¼ç®¡ç†çš„ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°å…¨å±€éƒ½é€šç”¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ä»»åŠ¡æ—¶ï¼Œæ¥æ·»åŠ ä¸€ä¸ªè‡ªå·±çš„å‡­è¯ã€‚ç‚¹å‡»é¡¹ç›®çš„ é…ç½®ï¼Œä¾æ¬¡æ‰¾åˆ° `æºç ç®¡ç†` => `Git` => `Repositories`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGOCkFdPLw5Wg0nleCN5xHFUZaWgAIHnLsTNM0gB7qbBENpS3libCSwibA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414235620

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGbMHialFWZ066DI2mFd5oIMEicN5BC4rkOicNOic8gmwOHE77HrdSk6GYJg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414235631

è¿™é‡Œçš„ `Repository URL` åˆ™æ˜¯æˆ‘ä»¬çš„ä»“åº“åœ°å€ï¼Œ SSH åœ°å€æ ¼å¼ä¸º `git@gitee.com:xxx/xxx.git`ã€‚å¯ä»¥ä»ä»“åº“é¦–é¡µä¸­çš„ `å…‹éš†/ä¸‹è½½` => `SSH` ä¸­çœ‹åˆ°

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG2AScZzm2guBMh9mowsrqDhnKFJtTvPxnpFdK3xJhZwtoqkCQZZ49Xw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414235645

é‡ç‚¹æ˜¯ `Credentials` è¿™ä¸€é¡¹ï¼Œè¿™é‡Œåˆ™æ˜¯æˆ‘ä»¬é€‰æ‹©è®¤è¯å‡­è¯çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å³ä¾§ `æ·»åŠ `=> `Jenkins` æŒ‰é’®æ·»åŠ ä¸€æ¡æ–°çš„å‡­è¯è®¤è¯ä¿¡æ¯ã€‚

ç‚¹å‡»åä¼šæ‰“å¼€ä¸€ä¸ªå¼¹çª—ï¼Œè¿™æ˜¯ Jenkins æ·»åŠ å‡­è¯çš„å¼¹çª—ã€‚é€‰æ‹©ç±»å‹ä¸­çš„ `SSH Username with private key` è¿™ä¸€é¡¹ã€‚æ¥ç€å¡«å†™ä¿¡æ¯å³å¯ï¼š

- `ID`ï¼šè¿™æ¡è®¤è¯å‡­è¯åœ¨ Jenkins ä¸­çš„åç§°æ˜¯ä»€ä¹ˆ
- `æè¿°`ï¼šæè¿°ä¿¡æ¯
- `Username`ï¼šç”¨æˆ·åï¼ˆé‚®ç®±ï¼‰
- `Private Key`ï¼šè¿™é‡Œåˆ™æ˜¯æˆ‘ä»¬å¡«å†™ç§é’¥çš„åœ°æ–¹ã€‚

åœ¨å‘½ä»¤è¡Œçª—å£ï¼ŒæŸ¥çœ‹ç§é’¥æ–‡ä»¶å†…å®¹ï¼Œå¹¶å¤åˆ¶å®ƒ

```
cat ~/.ssh/id_rsa
```

ç‚¹å‡» `Add` æŒ‰é’®ï¼Œå°† `xxx ç§é’¥æ–‡ä»¶`å†…æ‰€æœ‰æ–‡ä»¶å†…å®¹å…¨éƒ¨å¤åˆ¶è¿‡å»ï¼ˆåŒ…å«å¼€å¤´çš„ BEGIN OPENSSH PRIVATE KEY å’Œç»“å°¾çš„ END OPENSSH PRIVATE KEYï¼‰

æ¥ç€ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œä¿å­˜å‡­è¯ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGQy184ode9tTbUloTW0zxtCsLDxqbAKzgS8aa87c7Kj3Dvg7UxEeVEA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414235711

ä¿å­˜åï¼Œåœ¨ `Credentials` ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä½ æ·»åŠ çš„å‡­è¯ã€‚

å¦‚æœæ²¡æœ‰å‡ºç°çº¢è‰²æ— æƒé™æç¤ºï¼Œåˆ™ä»£è¡¨èº«ä»½æ ¡éªŒæˆåŠŸï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGMLTicKZkPwm0Nb6ICKPM3wXEPnEO9SibLJ7WY04ezKhZNT0Cm1HAb4ibg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210414235729

å¦‚æœå‡ºç°ä¸‹å›¾çš„é—®é¢˜ï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£… `Git`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGkEQfWmpwdUBOuv1moqJGqk008IK4fqENAJ4gXody0rHTVvV9JAicszw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)no-git

å®‰è£…ç»“æŸåï¼Œåˆ·æ–°ç•Œé¢å°±æ­£å¸¸äº†

```
yum -y install git
```

#### æ„å»ºé•œåƒ

åœ¨æˆ‘ä»¬å°†ç¯å¢ƒå‡†å¤‡å°±ç»ªåï¼Œå°±å¯ä»¥å¼€å§‹æ„å»ºé•œåƒäº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡ä¸ª `DockerFile` æ‰å¯ä»¥æ„å»ºé•œåƒã€‚é‚£ä»€ä¹ˆæ˜¯ `DockerFile` å‘¢ï¼Ÿ

#### ç¼–å†™ Dockerfile

ä»€ä¹ˆæ˜¯ `Dockerfile`

`Dockerfile` æ˜¯ä¸€ä¸ª `Docker` é•œåƒçš„åŸºç¡€æè¿°æ–‡ä»¶ï¼Œé‡Œé¢æè¿°äº†ç”Ÿæˆä¸€ä¸ªé•œåƒæ‰€éœ€è¦çš„æ‰§è¡Œæ­¥éª¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä»½ `Dockerfile` æ¥åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„é•œåƒã€‚

ä¾‹å¦‚ä¸‹é¢çš„æ­¥éª¤ï¼Œä½¿ç”¨ `Dockerfile` å¯æè¿°ä¸ºï¼š

1. ```
   åŸºäº `nginx:1.15` é•œåƒåšåº•åº§ã€‚
   ```

2. ```
   æ‹·è´æœ¬åœ° `html` æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ï¼Œåˆ°é•œåƒå†… `/etc/nginx/html` æ–‡ä»¶å¤¹ã€‚
   ```

3. ```
   æ‹·è´æœ¬åœ° `conf` æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ï¼Œåˆ°é•œåƒå†… `/etc/nginx/` æ–‡ä»¶å¤¹ã€‚
   ```

```
FROM nginx:1.15-alpineCOPY html /etc/nginx/htmlCOPY conf /etc/nginx/WORKDIR /etc/nginx/html
```

ç¼–å†™å®Œæˆåï¼Œæ€ä¹ˆç”Ÿæˆé•œåƒå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ `docker build` å‘½ä»¤å°±å¯ä»¥æ„å»ºä¸€ä¸ªé•œåƒäº†ï¼š

```
docker build -t imagename:version .
```

`-t`: å£°æ˜è¦æ‰“ä¸€ä¸ªé•œåƒçš„ Tag æ ‡ç­¾ï¼Œç´§è·Ÿç€çš„åé¢å°±æ˜¯æ ‡ç­¾ã€‚

æ ‡ç­¾æ ¼å¼ä¸º `é•œåƒå:ç‰ˆæœ¬ .` ï¼šå£°æ˜è¦å¯»æ‰¾`dockerfile`æ–‡ä»¶çš„è·¯å¾„. `.`ä»£è¡¨å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾ã€‚é»˜è®¤æ–‡ä»¶åä¸º `Dockerfile`ã€‚

å…³äºæ›´å¤š `DockerFile` çš„è¯­æ³•ï¼Œè¯¦ç»†å¯ä»¥çœ‹è¿™é‡Œ

å› ä¸ºæˆ‘ä»¬çš„é•œåƒåªåŒ…å«ä¸€ä¸ª `nginx`ï¼Œæ‰€ä»¥ `dockerfile` å†…å®¹æ¯”è¾ƒç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨ä»£ç æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º `Dockerfile` çš„æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œå¹¶å°†å…¶æäº¤åˆ°ä»£ç åº“å³å¯ã€‚

```
vi DockerfileFROM nginx:1.15-alpineCOPY html /etc/nginx/htmlCOPY conf /etc/nginx/WORKDIR /etc/nginx/htmlå¤åˆ¶ä»£ç 
git add ./Dockerfilegit commit -m "chore: add dockerfile"git push
```

#### Jenkins ç«¯é…ç½®

åœ¨ä»£ç æºå’Œ `DockerFile` å‡†å¤‡å°±ç»ªåã€‚åœ¨æœåŠ¡å™¨çš„`/data`ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`jenkins-shll.sh`è„šæœ¬æ–‡ä»¶

```
touch /data/jenkins-shll.shvi /data/jenkins-shll.sh
```

å¹¶åŠ å…¥å¦‚ä¸‹å†…å®¹

```
#!/bin/sh -lyarnyarn run builddocker build -t jenkins-test .
```

è¿™é‡Œè„šæœ¬å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯ä½œç”¨æ˜¯`å®‰è£…ä¾èµ–` => `æ„å»ºæ–‡ä»¶` => `æ„å»ºé•œåƒ`ã€‚

`#!/bin/sh \-l`çš„ä½œç”¨æ˜¯:

å¦‚æœåœ¨æœåŠ¡å™¨ä¸­çš„`shell`å‘½ä»¤å¯ä»¥æ‰§è¡Œï¼Œä½†åˆ°äº†`jenkins`ä¸­å´æ— æ³•æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸º`jenkins`æ²¡æœ‰åŠ è½½æœåŠ¡å™¨ä¸­çš„å…¨å±€å˜é‡`/etc/profile`å¯¼è‡´çš„

------

æœ€ååªéœ€åœ¨ `Jenkins` ç«¯é…ç½®ä¸‹è¦æ‰§è¡Œçš„ `Shell` è„šæœ¬å³å¯ã€‚æ‰¾åˆ°é¡¹ç›®çš„é…ç½®ï¼Œä¾æ¬¡æ‰¾åˆ°`æ„å»º`=> `Execute shell`ã€‚è¾“å…¥ä»¥ä¸‹è„šæœ¬ï¼š

```
sh /data/jenkins-shll.sh
```

#### æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡

ä¿å­˜åæˆ‘ä»¬å»æ‰‹åŠ¨è§¦å‘æ‰§è¡Œä¸‹ä»»åŠ¡ã€‚å½“æœªæŠ›å‡ºé”™è¯¯æ—¶ï¼Œä»£è¡¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGAbQDCjIYaUMYnib3qrTghCqgs15icS5qIUEI8LqACyYAIspjHKLX2diaw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210415000307

#### å›è¿‡å¤´æ¥æŸ¥çœ‹ docker

```
docker images
```

å¯ä»¥å‘ç°ï¼Œåˆå¤šäº†ä¸€ä¸ªåå«`jenkins-test` çš„ docker é•œåƒ

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGVZAIA3bj5gmLHUjdicw36UBoJDiaMPhNTiaTnjtCcM0AoP0riabzzgFXVQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)laest-docker-images

### è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡

#### å®‰è£…æ’ä»¶

å®‰è£… `Generic Webhook Trigger Plugin` æ’ä»¶ï¼ˆ`ç³»ç»Ÿç®¡ç†`-`æ’ä»¶ç®¡ç†`-`å¯ç”¨æ’ä»¶`-æœç´¢ `Generic Webhook`ï¼‰

é€‰ä¸­å¹¶ç‚¹å‡»`Install without restart`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGqXrygoRz5DCXsmKFic0IrJp67o0GrWZI6Pd8HAbOgv4P9MVicmPiaYJyQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)Generic-Webhook

å¦‚æœå¯é€‰æ’ä»¶åˆ—è¡¨ä¸ºç©ºï¼Œç‚¹å‡»é«˜çº§æ ‡ç­¾é¡µï¼Œæ›¿æ¢å‡çº§ç«™ç‚¹çš„ URL ä¸ºï¼š`http://mirror.xmission.com/jenkins/updates/update-center.json`å¹¶ä¸”ç‚¹å‡»æäº¤å’Œç«‹å³è·å–ã€‚

#### æ·»åŠ è§¦å‘å™¨

`Generic Webhook Trigger Plugin` æ’ä»¶åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„è§¦å‘å‚æ•°è§¦å‘ä¸åŒçš„æ„å»ºæ“ä½œï¼Œæ¯”å¦‚æˆ‘å‘è¿œç¨‹ä»“åº“æäº¤çš„æ˜¯ `master` åˆ†æ”¯çš„ä»£ç ï¼Œå°±æ‰§è¡Œä»£ç éƒ¨ç½²å·¥ä½œï¼Œæˆ‘å‘è¿œç¨‹ä»“åº“æäº¤çš„æ˜¯æŸä¸ª `feature`åˆ†æ”¯ï¼Œå°±æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•é€šè¿‡ååˆå¹¶è‡³ `dev` åˆ†æ”¯ã€‚

çµæ´»æ€§å¾ˆé«˜ï¼Œå¯ä»¥è‡ªå®šä¹‰é…ç½®é€‚åˆè‡ªå·±å…¬å¸çš„æ–¹æ¡ˆï¼Œè¿™é‡Œæ–¹ä¾¿æ¼”ç¤ºæˆ‘ä»¬ä¸åšä»»ä½•æ¡ä»¶åˆ¤æ–­ï¼Œåªè¦æœ‰`push`å°±è§¦å‘ã€‚

åœ¨ä»»åŠ¡é…ç½®->`è§¦å‘æ„å»ºèµ·`->é‡Œå‹¾é€‰ `Generic Webhook Trigger` ï¼Œç„¶åä¿å­˜å³å¯

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGDJuib1cbEO38adT7XaS67yib2vgQhwKia0CTeUR3ibc6ibqiafmBucnS2Lmg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)20210415001710

#### Git ä»“åº“é…ç½®é’©å­

æ­¤å¤„ä»¥ç äº‘ä¸ºä¾‹ï¼Œgithub çš„é…ç½®åŸºæœ¬ä¸€è‡´ï¼Œè¿›å…¥ç äº‘é¡¹ç›®ä¸»é¡µåï¼Œç‚¹å‡»`ç®¡ç†`-`webhooks`-`æ·»åŠ `ï¼Œä¼šè·³å‡ºä¸€ä¸ªè¿™æ ·çš„æ¡†æ¥ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGVv2jyhCGicF1sicRXUMCqgiaxEnGeEZv4TiaOufuSWUSa8OibwMKyASrhMA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)webhooks1

ä¸Šå›¾ä¸­çš„ URL æ ¼å¼ä¸º `http://:@:ç«¯å£/generic-webhook-trigger/invoke`

ä¸‹é¢çš„å‡ ä¸ªé€‰é¡¹æ˜¯ä½ åœ¨ä»“åº“æ‰§è¡Œä»€ä¹ˆæ“ä½œçš„æ—¶å€™è§¦å‘é’©å­ï¼Œè¿™é‡Œé»˜è®¤ç”¨ `push`ã€‚

- è·å–`User ID`

è¿›å…¥ jenkin çš„`ç³»ç»Ÿç®¡ç†`->`ç®¡ç†ç”¨æˆ·` ç•Œé¢, å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚åœ¨æ­¤åˆ—è¡¨ä¸­å°±æ‰¾åˆ°`User ID`.

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGEgDSvsEHo6icmyVx6cawtmX2iakRrtpRZ5MrVQfOtwIFxKtfWSSg32bw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)Jenkins-user-list

- è·å–`API Token`

æ¥ä¸‹æ¥ç‚¹å‡»`å·¥å…·å›¾æ ‡` è¿›å…¥è¯¦æƒ…ç•Œé¢åæ‰¾åˆ°`API Token`->`æ·»åŠ æ–°Token`->`ç”Ÿæˆ`->æ‰¾ä¸ªä½ å–œæ¬¢çš„åœ°æ–¹å°†æ­¤ token ä¿å­˜å¥½

- è·å–ç«¯å£

`Jenkins IP åœ°å€`å’Œç«¯å£æ˜¯ä½ éƒ¨ç½² jenkins æœåŠ¡å™¨çš„ ip åœ°å€ï¼Œç«¯å£å·æ²¡æ”¹è¿‡çš„è¯å°±æ˜¯ `8080`ã€‚

- è·å–å¯†ç 

`å¯†ç `å°±æ˜¯ä½ ç™»å½• jenkins çš„å¯†ç 

ç‚¹å‡»æäº¤å®Œæˆé…ç½®ã€‚æˆ‘ä»¬è¿˜éœ€è¦æµ‹è¯•ä¸€ä¸‹é’©å­æ˜¯å¦ç”Ÿæ•ˆ

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGWgHlUnVNNo7MkxArhOhLKuyHbayUpkTfsbUIzA8d8C0NPiaicZibPYicBg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)test-webhooks

ç‚¹å‡»`æµ‹è¯•`ï¼Œå¦‚æœé…ç½®æ˜¯æˆåŠŸçš„ï¼Œä½ çš„ `Jenkins` å·¦ä¾§æ æ„å»ºæ‰§è¡ŒçŠ¶æ€é‡Œå°†ä¼šå‡ºç°ä¸€ä¸ªä»»åŠ¡ã€‚

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDG9WJZmCSH5LIGFX2ISGy7kLYKDzxrIogxFFZIvl4iaFWxiaCMTqRvhgbQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

### å®ç°é‚®ä»¶æé†’-todo

### æ‰¹é‡åˆ é™¤æ„å»ºå†å²

è¿›å…¥`ç³»ç»Ÿé…ç½®`->`è„šæœ¬å‘½ä»¤è¿è¡Œ`

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/pfCCZhlbMQREv6Sia05dgCP8895uibVXDGicS6iaN9XhKQ8jqpywCU1IVAqLrOMpXaibibiccibeH1UgOLS3orRlaYFjWQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)jenkins-script-delete-history

è¾“å…¥è„šæœ¬

```
# "test"æ˜¯é¡¹ç›®åç§°ï¼Œ100æ˜¯æŒ‡ï¼ˆ0~Â·100ï¼‰å…¨åˆ é™¤ï¼Œå°±æ˜¯æ„å»ºå†å²å‰é¢çš„ID
def jobName = "test"

def maxNumber = 100

Jenkins.instance.getItemByFullName(jobName).builds.findAll {it.number <= maxNumber}.each { it.delete() }
```